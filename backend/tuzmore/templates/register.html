{% extends 'base.html' %}
{% block title %}Register{% endblock %}
{% block content %}
<div class="flex items-center justify-center min-h-screen bg-gray-100">
  <div class="w-full max-w-sm p-6 bg-white rounded-2xl shadow-lg">
    <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">Create an Account</h2>

    <form id="registerForm" class="space-y-4">
      {% csrf_token %}
      <input type="text" id="username" placeholder="Username" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"/>
      <input type="email" id="email" placeholder="Email" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"/>
      <input type="password" id="password" placeholder="Password" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"/>
      <button type="submit" class="w-full py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-200">Register</button>
    </form>

    <p id="error" class="mt-4 text-center text-red-500 text-sm"></p>
    <p class="mt-4 text-center text-gray-600 text-sm">
      Already have an account? <a href="{% url 'login' %}" class="text-blue-600 hover:underline">Login</a>
    </p>
  </div>
</div>

<script>
document.getElementById("registerForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const username = document.getElementById("username").value.trim();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

  if (!username || !email || !password) {
    document.getElementById("error").innerText = "All fields are required.";
    return;
  }

  try {
    const res = await fetch("/api/register/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": csrftoken
      },
      body: JSON.stringify({username, email, password})
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.detail || "Registration failed");

    alert("Registration successful! Please check your email to verify your account.");
    window.location.href = "{% url 'login' %}";
  } catch (err) {
    document.getElementById("error").innerText = err.message;
  }
});
</script>
{% endblock %}
