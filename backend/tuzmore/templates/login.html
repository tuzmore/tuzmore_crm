{% extends "base.html" %}
{% block title %}Login{% endblock %}
{% block content %}

<div class="flex justify-center items-center min-h-screen bg-gray-50">
  <div class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-md">
    
    <!-- Title -->
    <h2 class="text-2xl font-bold text-center text-gray-800 mb-2">
      Welcome Back
    </h2>
    <p class="text-center text-gray-500 mb-6 text-sm">
      Log in to access your dashboard and tools.
    </p>

    <!-- Form -->
    <form id="loginForm" class="space-y-4">
      <input type="text" id="username" placeholder="Username or Email" required
        class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2
        focus:ring-blue-600 focus:border-blue-600 outline-none">

      <input type="password" id="password" placeholder="Password" required
        class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2
        focus:ring-blue-600 focus:border-blue-600 outline-none">

      <button type="submit"
        class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium
        hover:bg-blue-700 transition-colors duration-300">
        Log In
      </button>
    </form>

    <!-- Login Message -->
    <p id="loginMessage" class="mt-4 text-center text-sm"></p>

    <!-- Register Redirect -->
    <p class="text-center text-gray-600 mt-6 text-sm">
      Don’t have an account?
      <a href="{% url 'register' %}" class="text-blue-600 font-medium hover:underline">Register</a>
    </p>
  </div>
</div>

<script>
document.getElementById("loginForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const data = {
    username: document.getElementById("username").value,
    password: document.getElementById("password").value,
  };

  try {
    const res = await fetch("/api/login/", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data),
    });

    const result = await res.json();
    const msg = document.getElementById("loginMessage");

    if (res.ok) {
      msg.textContent = "✅ Login successful! Redirecting...";
      msg.className = "text-green-600 text-center mt-4";

      // Save JWT
      localStorage.setItem("access", result.access);
      localStorage.setItem("refresh", result.refresh);

      // Redirect
      setTimeout(() => {
        window.location.href = "{% url 'dashboard' %}";
      }, 1000);
    } else {
      msg.textContent = result.detail || "❌ Invalid credentials.";
      msg.className = "text-red-600 text-center mt-4";
    }
  } catch (error) {
    console.error(error);
    const msg = document.getElementById("loginMessage");
    msg.textContent = "❌ Something went wrong. Try again.";
    msg.className = "text-red-600 text-center mt-4";
  }
});
</script>

{% endblock %}
