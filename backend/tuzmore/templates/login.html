{% extends 'base.html' %}
{% block title %}Login{% endblock %}
{% block content %}

<div class="min-h-screen flex items-center justify-center bg-gray-100 px-4">
  <div class="w-full max-w-md bg-white shadow-lg rounded-2xl p-8">
    <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">Login</h2>
    
    <form id="loginForm" class="space-y-5">
      {% csrf_token %}
      <div>
        <input type="text" id="username" placeholder="Username" required
               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"/>
      </div>
      <div>
        <input type="password" id="password" placeholder="Password" required
               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"/>
      </div>
      <button type="submit" class="w-full py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition">
        Login
      </button>
    </form>

    <p id="loginMessage" class="text-center text-red-500 mt-4"></p>

    <p class="text-center text-gray-600 text-sm mt-6">
      Donâ€™t have an account? 
      <a href="{% url 'register' %}" class="text-indigo-600 font-medium hover:underline">Register</a>
    </p>
  </div>
</div>

<script>
document.getElementById("loginForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
  const loginMessage = document.getElementById("loginMessage");
  loginMessage.innerText = "";

  if (!username || !password) {
    loginMessage.innerText = "Please enter both username and password.";
    return;
  }

  try {
    const res = await fetch("/api/login/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": csrftoken
      },
      body: JSON.stringify({username, password}),
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.detail || "Login failed");

    loginMessage.classList.remove("text-red-500");
    loginMessage.classList.add("text-green-500");
    loginMessage.innerText = "Login successful! Redirecting...";

    setTimeout(() => {
      window.location.href = "/dashboard/";
    }, 800);

  } catch (err) {
    loginMessage.classList.remove("text-green-500");
    loginMessage.classList.add("text-red-500");
    loginMessage.innerText = err.message;
  }
});
</script>

{% endblock %}
